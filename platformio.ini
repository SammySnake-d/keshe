[env:esp32-s3-pole-monitor]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

; --- 核心硬件配置 (针对 N8R2) ---
; 1. 声明 Flash 大小为 8MB
board_upload.flash_size = 8MB
; 2. 关键！声明内存模式为 QSPI (适配 2MB PSRAM)
; 如果不加这行，PSRAM 即使开启了也无法使用，或者会导致无限重启
board_build.arduino.memory_type = dio_qspi

; --- 分区表 ---
; 建议改用 8MB 分区表，比 huge_app.csv 能利用更多空间
; 同时也支持 OTA 和大文件系统
board_build.partitions = default_8MB.csv

; --- 编译宏定义 ---
build_flags = 
    -DBOARD_HAS_PSRAM               ; 告诉代码开启 PSRAM 支持
    -mfix-esp32-psram-cache-issue   ; 修复 PSRAM 缓存硬件缺陷
    -DCORE_DEBUG_LEVEL=3            ; 开启 Info 级别的调试日志
    -DCONFIG_ARDUHAL_LOG_COLORS=1   ; 彩色日志

; --- 源码过滤 (排除 project-name 防止冲突) ---
build_src_filter = 
    +<*>
    -<../project-name/>

; --- 依赖库 (保持不变) ---
lib_deps = 
    mikalhart/TinyGPSPlus @ ^1.0.3
    knolleary/PubSubClient @ ^2.8
    https://github.com/sparkfun/SparkFun_LSM6DS3_Arduino_Library.git
    espressif/esp32-camera @ ^2.0.0
    bblanchon/ArduinoJson@^6.21.0

; ========================================
; 测试环境配置
; 说明：通过 -DUSE_MOCK_HARDWARE=1/0 控制 Mock/Real 模式
; ========================================

[env:test-battery]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

board_upload.flash_size = 8MB
board_build.arduino.memory_type = qio_qspi

build_flags = 
    -DCORE_DEBUG_LEVEL=4
    -DUSE_MOCK_HARDWARE=1  ; 1=Mock模式(Wokwi), 0=Real模式(真实硬件)

build_src_filter = 
    -<*>
    +<../test/test_battery/>

[env:test-lsm6ds3]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

board_upload.flash_size = 8MB
board_build.arduino.memory_type = qio_qspi

build_flags = 
    -DCORE_DEBUG_LEVEL=4
    -DUSE_MOCK_HARDWARE=1

build_src_filter = 
    -<*>
    +<../test/test_lsm6ds3/>

lib_ignore = Unity

lib_deps = 
    https://github.com/sparkfun/SparkFun_LSM6DS3_Arduino_Library.git

[env:test-ov2640]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

board_upload.flash_size = 8MB
board_build.arduino.memory_type = qio_qspi

build_flags = 
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DCORE_DEBUG_LEVEL=4
    -DUSE_MOCK_HARDWARE=1

build_src_filter = 
    -<*>
    +<../test/test_ov2640/>

lib_ignore = Unity

lib_deps = 
    espressif/esp32-camera @ ^2.0.0

[env:test-ec800k]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

board_upload.flash_size = 8MB
board_build.arduino.memory_type = qio_qspi

build_flags = 
    -DCORE_DEBUG_LEVEL=4
    -DUSE_MOCK_HARDWARE=1

build_src_filter = 
    -<*>
    +<../test/test_ec800k/>

lib_ignore = Unity

[env:test-gps]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

board_upload.flash_size = 8MB
board_build.arduino.memory_type = qio_qspi

build_flags = 
    -DCORE_DEBUG_LEVEL=4

build_src_filter = 
    -<*>
    +<../test/test_gps/test_gps_raw.cpp>

lib_ignore = Unity

[env:test-gps-tinygps]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

board_upload.flash_size = 8MB
board_build.arduino.memory_type = qio_qspi

build_flags = 
    -DCORE_DEBUG_LEVEL=4
    -DUSE_MOCK_HARDWARE=0

build_src_filter = 
    -<*>
    +<../test/test_gps/>

lib_ignore = Unity

lib_deps = 
    mikalhart/TinyGPSPlus @ ^1.0.3

[env:test-audio]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

board_upload.flash_size = 8MB
board_build.arduino.memory_type = qio_qspi

build_flags = 
    -DCORE_DEBUG_LEVEL=4
    -DUSE_MOCK_HARDWARE=1

build_src_filter = 
    -<*>
    +<../test/test_audio/>

lib_ignore = Unity

[env:test-psram]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

board_upload.flash_size = 8MB
board_build.arduino.memory_type = qio_qspi

build_flags = 
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DCORE_DEBUG_LEVEL=4
    -DUSE_MOCK_HARDWARE=1

build_src_filter = 
    -<*>
    +<../test/test_psram/>

lib_ignore = Unity
